<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carpeta {{ folder.name }} - ImportSystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
    <script src="{{ url_for('static', filename='js/ver_carpeta.js') }}"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .-rotate--90 {
        transform: rotate(-90deg);
        transition: transform 0.2s ease-in-out;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    {% include 'base.html' %}

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Header con información de carpeta -->
      <div
        class="flex flex-col md:flex-row md:items-center md:justify-between mb-6"
      >
        <div>
          <h1 class="text-3xl font-bold text-gray-900">{{ folder.name }}</h1>
          <p class="text-sm text-gray-500 mt-1">ID: {{ folder.drive_id }}</p>
        </div>

        <div class="mt-4 md:mt-0">
          <button
            type="button"
            onclick="document.getElementById('importModal').classList.remove('hidden')"
            class="flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out"
          >
            Importar archivos
          </button>
          <!-- Modal (oculto por defecto) -->
          <div
            id="importModal"
            class="hidden fixed inset-0 z-50 overflow-y-auto"
            aria-labelledby="modal-title"
            role="dialog"
            aria-modal="true"
          >
            <div
              class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
            >
              <!-- Overlay de fondo oscuro -->
              <div
                class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                aria-hidden="true"
                onclick="document.getElementById('importModal').classList.add('hidden')"
              ></div>

              <!-- Centrado vertical trick -->
              <span
                class="hidden sm:inline-block sm:align-middle sm:h-screen"
                aria-hidden="true"
                >&#8203;</span
              >

              <!-- Modal content -->
              <div
                class="inline-block align-bottom bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
              >
                <!-- Header del modal con título y botón de cierre -->
                <div
                  class="px-6 py-4 border-b border-gray-100 flex items-center justify-between"
                >
                  <h3
                    class="text-xl font-bold text-gray-900 flex items-center"
                    id="modal-title"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5 text-red-600 mr-2"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"
                      />
                    </svg>
                    Importar archivo
                  </h3>
                  <button
                    type="button"
                    class="text-gray-400 hover:text-gray-500 focus:outline-none"
                    onclick="document.getElementById('importModal').classList.add('hidden')"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-6 w-6"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M6 18L18 6M6 6l12 12"
                      />
                    </svg>
                  </button>
                </div>

                <!-- Contenido principal del modal -->
                <div class="px-6 py-5">
                  <!-- Área de arrastrar y soltar (drag & drop) -->
                  <form
                    method="POST"
                    id="importForm"
                    enctype="multipart/form-data"
                    action="{{ url_for('main.subir_archivo', folder_id=folder.id) }}"
                  >
                    {{ form.hidden_tag() }}

                    <div
                      class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg py-8 px-4 text-center transition-all duration-200"
                      id="dropZone"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="mx-auto h-12 w-12 text-gray-400"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                        />
                      </svg>

                      <div class="mt-3">
                        <input
                          type="file"
                          name="file"
                          id="file"
                          required
                          class="hidden"
                          onchange="updateFileName(this)"
                        />

                        <p class="text-sm font-medium text-gray-700">
                          <span id="fileNameDisplay" class="block mb-1"
                            >Selecciona un archivo para importar</span
                          >
                          <span class="text-xs text-gray-500"
                            >o arrastra y suelta aquí</span
                          >
                        </p>

                        <button
                          type="button"
                          class="mt-3 inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
                          onclick="document.getElementById('file').click()"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4 mr-1"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"
                            />
                          </svg>
                          Examinar archivos
                        </button>
                      </div>
                    </div>

                    <!-- Información sobre formatos aceptados -->
                    <div class="mt-4 flex items-start">
                      <div class="flex-shrink-0">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-5 w-5 text-blue-500"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                          />
                        </svg>
                      </div>
                      <div class="ml-3">
                        <p class="text-xs text-gray-500">
                          Formatos aceptados:
                          <span class="font-medium"
                            >PDF, XLS, XLSX, CSV, DOC, DOCX</span
                          >
                          <br />Tamaño máximo de archivo:
                          <span class="font-medium">10MB</span>
                        </p>
                      </div>
                    </div>

                    <!-- Etiqueta del archivo - Siempre visible -->
                    <div class="mt-4 border-t border-gray-100 pt-4">
                      <div
                        class="bg-red-50 rounded-lg p-4 border-l-4 border-red-500 relative"
                      >
                        <div
                          class="absolute -top-3 -left-1 bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-sm"
                        >
                          Importante
                        </div>
                        <label
                          for="fileLabel"
                          class="block text-base font-bold text-gray-800 mb-2 flex items-center"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 mr-2 text-red-600"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"
                            />
                          </svg>
                          Etiqueta del archivo
                        </label>
                        <p class="text-xs text-gray-600 mb-3">
                          Selecciona una categoría para organizar y encontrar
                          fácilmente este documento en el futuro
                        </p>
                        <select
                          id="fileLabel"
                          name="fileLabel"
                          class="block w-full pl-3 pr-10 py-3 text-base border-2 border-red-300 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 sm:text-sm rounded-md bg-white shadow-sm"
                        >
                          <option value="">-- Seleccionar etiqueta --</option>
                          <optgroup label="Documentos personales">
                            <option value="Pasaporte">Pasaporte</option>
                            <option value="Documento de identidad">
                              Documento de identidad
                            </option>
                            <option value="Licencia de conducir">
                              Licencia de conducir
                            </option>
                            <option value="Permiso de residencia">
                              Permiso de residencia
                            </option>
                            <option value="Certificado de nacimiento">
                              Certificado de nacimiento
                            </option>
                          </optgroup>
                          <optgroup label="Documentos financieros">
                            <option value="Facturas">Factura</option>
                            <option value="Recibos de pago">
                              Recibo de pago
                            </option>
                            <option value="Estados de cuenta">
                              Estado de cuenta bancario
                            </option>
                            <option value="Documento fiscal">
                              Documento fiscal
                            </option>
                            <option value="Nomina">Nómina</option>
                          </optgroup>
                          <optgroup label="Documentos legales">
                            <option value="Contrato">Contrato</option>
                            <option value="Poder notarial">
                              Poder notarial
                            </option>
                            <option value="Certificado legal">
                              Certificado legal
                            </option>
                          </optgroup>
                          <optgroup label="Otros documentos">
                            <option value="Documento medio">
                              Documento médico
                            </option>
                            <option value="Documento educativo">
                              Documento educativo
                            </option>
                            <option value="Documento de propiedad">
                              Documento de propiedad
                            </option>
                            <option value="Documento tecnico">
                              Documento técnico
                            </option>
                            <option value="Otros">Otro</option>
                          </optgroup>
                        </select>
                        <input
                          type="hidden"
                          id="groupLabel"
                          name="groupLabel"
                          value=""
                        />
                      </div>
                    </div>
                  </form>
                </div>

                <!-- Footer con botones de acción -->
                <div
                  class="px-6 py-4 bg-gray-50 flex flex-col-reverse sm:flex-row sm:justify-end space-y-reverse space-y-3 sm:space-y-0 sm:space-x-3"
                >
                  <button
                    type="button"
                    class="sm:order-1 inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
                    onclick="document.getElementById('importModal').classList.add('hidden')"
                  >
                    Cancelar
                  </button>
                  <button
                    type="submit"
                    form="importForm"
                    class="sm:order-2 inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4 mr-1.5"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"
                      />
                    </svg>
                    Importar archivo
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Contenido de la carpeta -->
      <div
        class="bg-white shadow-md rounded-lg border border-gray-100 overflow-hidden"
      >
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-xl font-bold text-gray-900">
            Archivos en esta carpeta
          </h2>
        </div>
        {% if folder.files %}
        <div class=" p-4">
          {% for group_lbl, subdict in by_group.items() %} {% set group_index =
          loop.index %}
          <div class="group-folder mb-4">
            <!-- Grupo principal desplegable -->
            <div
              class="group-header bg-gray-100 p-3 rounded-t-lg flex items-center cursor-pointer shadow-sm"
              onclick="toggleGroup('group_{{ group_index }}')"
            >
              <!-- Ícono flecha (Chevron) -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 mr-2 text-red-600 transform transition-transform duration-200"
                id="group_icon_{{ group_index }}"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <!-- Flecha apuntando abajo por defecto (Tailwind rotate classes se aplican dinámicamente) -->
                <path
                  fill-rule="evenodd"
                  d="M5.293 7.293a1 1 0 011.414 0L10 10.586
                      l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0
                      l-4-4a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              </svg>

              <!-- Ícono de carpeta -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6 mr-2 text-red-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9
                           a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"
                />
              </svg>

              <h2 class="text-lg font-bold">{{ group_lbl }}</h2>
              <span
                class="ml-auto text-xs text-gray-500 bg-gray-200 rounded-full px-2 py-1"
              >
                {% set total_files = namespace(count=0) %} {% for file_lbl,
                files in subdict.items() %} {% set total_files.count =
                total_files.count + files|length %} {% endfor %} {{
                total_files.count }} {{ 'archivo' if total_files.count == 1 else
                'archivos' }}
              </span>
            </div>

            <!-- Contenedor de subcarpetas -->
            <div
              class="group-content pl-4 border-l-2 border-gray-200 ml-3"
              id="group_{{ group_index }}"
            >
              {% for file_lbl, files in subdict.items() %}
              <div class="label-folder mt-2 mb-2">
                <!-- Subcarpeta desplegable -->
                <div
                  class="label-header flex items-center p-2 bg-gray-50 rounded cursor-pointer hover:bg-gray-100"
                  onclick="toggleLabel('label_{{ group_index }}_{{ loop.index }}')"
                >
                  <!-- Ícono flecha subcarpeta -->
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4 mr-2 text-gray-600 transform transition-transform duration-200"
                    id="label_icon_{{ group_index }}_{{ loop.index }}"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M5.293 7.293a1 1 0 011.414 0L10 10.586
                                 l3.293-3.293a1 1 0 111.414 1.414l-4 4
                                 a1 1 0 01-1.414 0l-4-4a1 1
                                 0 010-1.414z"
                      clip-rule="evenodd"
                    />
                  </svg>

                  <!-- Ícono subcarpeta -->
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4 mr-2 text-red-600"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9
                              a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"
                    />
                  </svg>

                  <h3 class="text-md font-semibold">{{ file_lbl }}</h3>
                  <span class="ml-auto text-xs text-gray-500">
                    {{ files|length }} {{ 'archivo' if files|length == 1 else
                    'archivos' }}
                  </span>
                </div>

                <!-- Lista de archivos -->
                <div
                  class="label-files ml-8 mt-1"
                  id="label_{{ group_index }}_{{ loop.index }}"
                >
                  <!-- Tus archivos: -->
                  <ul class="border-l border-gray-200 pl-3">
                    {% for f in files %}
                    <li
                      class="flex items-center py-1 group hover:bg-gray-50 rounded px-2"
                    >
                      {% set file_extension = f.filename.split('.')[-1]|lower %}

                      <!-- Icono basado en la extensión del archivo -->
                      {% if file_extension in ['pdf'] %}
                      <svg
                        class="h-4 w-4 text-red-500 mr-2"
                        fill="currentColor"
                        viewBox="0 0 384 512"
                      >
                        <path
                          d="M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48zm250.2-143.7c-12.2-12-47-8.7-64.4-6.5-17.2-10.5-28.7-25-36.8-46.3 3.9-16.1 10.1-40.6 5.4-56-4.2-26.2-37.8-23.6-42.6-5.9-4.4 16.1-.4 38.5 7 67.1-10 23.9-24.9 56-35.4 74.4-20 10.3-47 26.2-51 46.2-3.3 15.8 26 55.2 76.1-31.2 22.4-7.4 46.8-16.5 68.4-20.1 18.9 10.2 41 17 55.8 17 25.5 0 28-28.2 17.5-38.7zm-198.1 77.8c5.1-13.7 24.5-29.5 30.4-35-19 30.3-30.4 35.7-30.4 35zm81.6-190.6c7.4 0 6.7 32.1 1.8 40.8-4.4-13.9-4.3-40.8-1.8-40.8zm-24.4 136.6c9.7-16.9 18-37 24.7-54.7 8.3 15.1 18.9 27.2 30.1 35.5-20.8 4.3-38.9 13.1-54.8 19.2zm131.6-5s-5 6-37.3-7.8c35.1-2.6 40.9 5.4 37.3 7.8z"
                        />
                      </svg>
                      {% elif file_extension in ['doc', 'docx'] %}
                      <svg
                        class="h-4 w-4 text-blue-600 mr-2"
                        fill="currentColor"
                        viewBox="0 0 384 512"
                      >
                        <path
                          d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm57.1 120H208c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h73.1c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zm0 96H208c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h73.1c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"
                        />
                      </svg>
                      {% elif file_extension in ['xls', 'xlsx', 'csv'] %}
                      <svg
                        class="h-4 w-4 text-green-600 mr-2"
                        fill="currentColor"
                        viewBox="0 0 384 512"
                      >
                        <path
                          d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm60.1 106.5L224 336l60.1 93.5c5.1 8-.6 18.5-10.1 18.5h-34.9c-4.4 0-8.5-2.4-10.6-6.3C208.9 405.5 192 373 192 373c-6.4 14.8-10 20-36.6 68.8-2.1 3.9-6.1 6.3-10.5 6.3H110c-9.5 0-15.2-10.5-10.1-18.5L160 336l-60.1-93.5c-5.1-8 .6-18.5 10.1-18.5h34.9c4.4 0 8.5 2.4 10.6 6.3 21.2 38.9 33.2 58 33.2 58 3.3-7.9 36.5-74.3 36.5-74.3 2.1-3.9 6.2-6.3 10.6-6.3H270c9.5-.1 15.2 10.4 10.1 18.5zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"
                        />
                      </svg>
                      {% elif file_extension in ['jpg', 'jpeg', 'png', 'gif'] %}
                      <svg
                        class="h-4 w-4 text-purple-500 mr-2"
                        fill="currentColor"
                        viewBox="0 0 384 512"
                      >
                        <path
                          d="M384 121.941V128H256V0h6.059a24 24 0 0 1 16.97 7.029l97.941 97.941a24.002 24.002 0 0 1 7.03 16.971zM248 160c-13.2 0-24-10.8-24-24V0H24C10.745 0 0 10.745 0 24v464c0 13.255 10.745 24 24 24h336c13.255 0 24-10.745 24-24V160H248zm-135.455 16c26.51 0 48 21.49 48 48s-21.49 48-48 48-48-21.49-48-48 21.491-48 48-48zm208 240h-256l.485-48.485L104.545 328c4.686-4.686 11.799-4.686 16.485 0L160.545 368 264.06 264.485c4.686-4.686 12.284-4.686 16.971 0L320.545 304v112z"
                        />
                      </svg>
                      {% else %}
                      <svg
                        class="h-4 w-4 text-gray-400 mr-2"
                        fill="currentColor"
                        viewBox="0 0 384 512"
                      >
                        <path
                          d="M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"
                        />
                      </svg>
                      {% endif %}

                      <a
                        href="{{ url_for('main.descargar_archivo', file_id=f.id) }}"
                        class="text-sm text-gray-700 hover:text-red-600"
                      >
                        {{ f.filename }}
                      </a>

                      <!-- Fecha de subida y tamaño -->
                      <span class="text-xs text-gray-500 ml-auto"></span>

                      <!-- Acciones (visibles al hacer hover) -->
                      <div
                        class="ml-2 opacity-0 group-hover:opacity-100 transition-opacity flex space-x-1"
                      >
                        <a
                          href="{{ url_for('main.descargar_archivo', file_id=f.id) }}"
                          class="text-gray-500 hover:text-blue-600"
                          title="Descargar"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                            />
                          </svg>
                        </a>
                        <a
                          href="{{ url_for('main.eliminar_archivo', file_id=f.id) }}"
                          class="text-gray-500 hover:text-red-600"
                          title="Eliminar"
                          onclick="return confirm('¿Estás seguro de que deseas eliminar este archivo?');"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                            />
                          </svg>
                        </a>
                      </div>
                    </li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endfor %}
        </div>

        {% else %}

        <div class="px-6 py-10 text-center">
          <div
            class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-100 text-gray-400 mb-4"
          >
            <i class="fas fa-folder-open text-xl"></i>
          </div>
          <p class="text-sm text-gray-600">Esta carpeta está vacía</p>
          <p class="text-xs text-gray-500 mt-1">Sube archivos para comenzar</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Modal de confirmación para eliminar archivo (oculto por defecto) -->
    <div
      id="deleteModal"
      class="hidden fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50"
    >
      <div class="bg-white rounded-lg max-w-md w-full p-6">
        <div class="text-center mb-4">
          <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
          <h3 class="text-lg font-medium text-gray-900 mt-2">
            ¿Eliminar archivo?
          </h3>
          <p class="text-sm text-gray-500 mt-1">
            Esta acción no se puede deshacer
          </p>
        </div>
        <div class="flex justify-end space-x-3 mt-6">
          <button
            onclick="closeDeleteModal()"
            class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"
          >
            Cancelar
          </button>
          <button
            id="confirmDeleteBtn"
            class="px-4 py-2 bg-red-600 border border-transparent rounded-lg text-sm font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
          >
            Eliminar
          </button>
        </div>
      </div>
    </div>
    <script>
      document
        .getElementById("fileLabel")
        .addEventListener("change", function () {
          const select = this;
          // El optgroup de la opción elegida
          const optGroupLabel = select.selectedOptions[0].parentNode.label;
          document.getElementById("groupLabel").value = optGroupLabel;
        });
    </script>

    <script>
      // Funciones para manejar la eliminación de archivos
      let fileIdToDelete;

      function confirmDelete(fileId) {
        fileIdToDelete = fileId;
        document.getElementById("deleteModal").classList.remove("hidden");
      }

      function closeDeleteModal() {
        document.getElementById("deleteModal").classList.add("hidden");
      }

      document
        .getElementById("confirmDeleteBtn")
        .addEventListener("click", function () {
          // Redireccionar a la ruta de eliminación
          window.location.href =
            "{{ url_for('main.eliminar_archivo', file_id=0) }}".replace(
              "0",
              fileIdToDelete
            );
        });

      function confirmDeleteFolder(folderId) {
        if (
          confirm(
            "¿Estás seguro de que quieres eliminar esta carpeta y todo su contenido?"
          )
        ) {
          window.location.href =
            "{{ url_for('main.eliminar_carpeta', folder_id=0) }}".replace(
              "0",
              folderId
            );
        }
      }
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const groupContents = document.querySelectorAll('[id^="group_"]');
        groupContents.forEach((el) => {
          el.style.display = "none";
          const idx = el.id.split("_")[1];
          const icon = document.getElementById("group_icon_" + idx);
          if (icon) icon.classList.add("-rotate-90"); // Tailwind: -rotate-90
        });

        const labelContents = document.querySelectorAll('[id^="label_"]');
        labelContents.forEach((el) => {
          el.style.display = "none";
          // Rotar flecha -90°:
          const idx = el.id.replace("label_", "");
          const icon = document.getElementById("label_icon_" + idx);
          if (icon) icon.classList.add("-rotate-90");
        });
      });

      // Toggle de grupo principal
      function toggleGroup(groupId) {
        const groupContent = document.getElementById(groupId);
        const idx = groupId.split("_")[1];
        const icon = document.getElementById("group_icon_" + idx);

        if (groupContent.style.display === "none") {
          // abrir
          groupContent.style.display = "block";
          icon?.classList.remove("-rotate-90");
        } else {
          // cerrar
          groupContent.style.display = "none";
          icon?.classList.add("-rotate-90");
        }
      }

      // Toggle de subcarpeta
      function toggleLabel(labelId) {
        const labelContent = document.getElementById(labelId);
        const idx = labelId.replace("label_", "");
        const icon = document.getElementById("label_icon_" + idx);

        if (labelContent.style.display === "none") {
          labelContent.style.display = "block";
          icon?.classList.remove("-rotate-90");
        } else {
          labelContent.style.display = "none";
          icon?.classList.add("-rotate-90");
        }
      }
    </script>
  </body>
</html>
